var app=angular.module("wtt",["angular-ladda","cgBusy"]);app.config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}]),app.controller("appController",["$scope","$http","$q",function(e,t,o){e.error=null,e.message="Invalid Email or Password",e.loading=!1,e.logo=wtt_admin_globals.pluginsUrl+"images/wtt_logo.png",e.promiseTemplate=wtt_admin_globals.pluginsUrl+"partials/directives/loadingTemplate.html",e.promiseMessage="Please wait...";var n=wtt_admin_globals.wtt_base_api_url;e.WttAppUrl=n.slice(0,-5)+"/#/",e.loginModel={RememberMe:!0};var r=function(e){var n=o.defer();return t.get(e,{withCredentials:!0}).success(function(e,t,o,r){n.resolve(e)}).error(function(e,t){n.reject(e.Message)}),n.promise},a=function(n,r){var a=o.defer();return t.post(n,r,{withCredentials:!0}).success(function(e,t,o,n){a.resolve(e)}).error(function(t,o){a.reject(t.Message),e.error=t.Message,e.loading=!1}),a.promise},l=function(e){var t=o.defer();return jQuery.ajax({url:webtexttoolnonce.ajaxurl,type:"POST",dataType:"json",data:{action:webtexttoolnonce.action,nonce:webtexttoolnonce.nonce,data:e},success:function(e){t.resolve(e)},error:function(e,t,o){console.log(JSON.stringify(e)),console.log("AJAX error: "+t+" : "+o)}}),t.promise};e.login=function(){e.loading=!0,a(n+"user/login",e.loginModel).then(function(t){t?(localStorage.setItem("wtt_token",t.access_token),l(t.access_token).then(function(){window.location.reload()})):(e.loading=!1,e.error=e.message)})},e.logout=function(){e.loading=!0,r(n+"user/logout").then(function(){localStorage.removeItem("wtt_token"),l("").then(function(){window.location.reload()})})},function(){if(null===localStorage.getItem("wtt_token")){var t=wtt_admin_globals.authcode;""!==t&&localStorage.setItem("wtt_token",t)}r(n+"user/authenticated").then(function(t){e.auth=t,t&&(e.accountPromise=r(n+"user/info").then(function(t){e.userInfo=t,e.displayTrialDays=function(e){return e<=0?"0":e}}))})}()}]),app.factory("authInterceptor",["$q",function(e){return{request:function(e){return e.url.indexOf(wtt_admin_globals.wtt_short_url)>0&&(e.headers=e.headers||{},e.headers.Authorization="Bearer "+localStorage.getItem("wtt_token"),e.headers.WttSource="WordPress"),e},response:function(t){return t||e.when(t)}}}]);